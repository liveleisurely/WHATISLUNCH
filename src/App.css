import React, { useState, useEffect } from 'react';
import { BrowserRouter as Router, Route, Switch, Link } from 'react-router-dom';
import { Container, Typography, TextField, Button, Box, Table, TableBody, TableCell, TableContainer, TableHead, TableRow, Paper, Grid } from '@mui/material';
import axios from 'axios';
import AddRestaurant from './AddRestaurant';

const App = () => {
  const [restaurants, setRestaurants] = useState([]);
  const [recommended, setRecommended] = useState(null);

  useEffect(() => {
    axios.get('/restaurants.json')
      .then(response => {
        setRestaurants(response.data.restaurants);
      })
      .catch(error => {
        console.error('Error fetching data:', error);
      });
  }, []);

  const recommendRestaurant = () => {
    const randomRestaurant = restaurants[Math.floor(Math.random() * restaurants.length)];
    setRecommended(randomRestaurant);
  };

  const addRestaurant = (newRestaurant) => {
    setRestaurants([...restaurants, newRestaurant]);
  };

  const categorizedRestaurants = {
    '한식': [],
    '일식': [],
    '중식': [],
    '양식': [],
    '분식': [],
    '기타': []
  };

  restaurants.forEach(restaurant => {
    categorizedRestaurants[restaurant.category].push(restaurant);
  });

  return (
    <Router>
      <Switch>
        <Route exact path="/">
          <Container maxWidth="md" style={{ backgroundColor: '#f0f0f0', padding: '20px', borderRadius: '8px', marginTop: '20px' }}>
            <Typography variant="h3" align="center" gutterBottom>
              오늘 점심은?
            </Typography>
            <Box style={{ display: 'flex', justifyContent: 'center', marginBottom: '20px' }}>
              <Button variant="contained" color="primary" onClick={recommendRestaurant} style={{ marginBottom: '20px' }}>
                오늘의 점심은?!
              </Button>
            </Box>
            {recommended && (
              <Typography variant="h5" align="center" style={{ marginBottom: '20px' }}>
                {recommended.name} - {recommended.menu}
              </Typography>
            )}
            <Typography variant="h4" align="center" gutterBottom>
              맛집 리스트
            </Typography>
            <Grid container spacing={3}>
              {Object.keys(categorizedRestaurants).map(category => (
                <Grid item xs={12} sm={6} key={category}>
                  <Typography variant="h5" align="center" gutterBottom>
                    {category}
                  </Typography>
                  <TableContainer component={Paper}>
                    <Table>
                      <TableHead>
                        <TableRow>
                          <TableCell>가게이름</TableCell>
                          <TableCell>주요메뉴</TableCell>
                          <TableCell>회사와의 거리</TableCell>
                        </TableRow>
                      </TableHead>
                      <TableBody>
                        {categorizedRestaurants[category].map((restaurant, index) => (
                          <TableRow key={index}>
                            <TableCell>{restaurant.name}</TableCell>
                            <TableCell>{restaurant.menu}</TableCell>
                            <TableCell>{restaurant.distance}</TableCell>
                          </TableRow>
                        ))}
                      </TableBody>
                    </Table>
                  </TableContainer>
                </Grid>
              ))}
            </Grid>
            <Box style={{ display: 'flex', justifyContent: 'center', marginTop: '40px' }}>
              <Button variant="contained" color="primary" component={Link} to="/add">
                밥집 데이터 추가하기
              </Button>
            </Box>
          </Container>
        </Route>
        <Route path="/add">
          <AddRestaurant addRestaurant={addRestaurant} />
        </Route>
      </Switch>
    </Router>
  );
};

export default App;
